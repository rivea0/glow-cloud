import { countryCodeMap, weatherCodes } from './constants';
import type { IHeadersList, IHourlyData } from './types';

export function beaufortScale(mph: number) {
  if (mph === 0) {
    return {
      description: 'calm',
      scale: 0,
    };
  } else if (mph >= 1 && mph <= 3) {
    return {
      description: 'light air',
      scale: 1,
    };
  } else if (mph >= 4 && mph <= 7) {
    return {
      description: 'light breeze',
      scale: 2,
    };
  } else if (mph >= 8 && mph <= 12) {
    return {
      description: 'gentle breeze',
      scale: 3,
    };
  } else if (mph >= 13 && mph <= 18) {
    return {
      description: 'moderate',
      scale: 4,
    };
  } else if (mph >= 19 && mph <= 24) {
    return {
      description: 'fresh',
      scale: 5,
    };
  } else if (mph >= 25 && mph <= 31) {
    return {
      description: 'strong',
      scale: 6,
    };
  } else if (mph >= 32 && mph <= 38) {
    return {
      description: 'near gale',
      scale: 7,
    };
  } else if (mph >= 39 && mph <= 46) {
    return {
      description: 'gale',
      scale: 8,
    };
  } else if (mph >= 47 && mph <= 54) {
    return {
      description: 'strong gale',
      scale: 9,
    };
  } else if (mph >= 55 && mph <= 63) {
    return {
      description: 'storm',
      scale: 10,
    };
  } else if (mph >= 64 && mph <= 73) {
    return {
      description: 'violent storm',
      scale: 11,
    };
  } else if (mph >= 74 && mph <= 95) {
    return {
      description: 'hurricane',
      scale: 12,
    };
  }
}

export function getCountryNameFromCountryCode(
  countryCode: keyof typeof countryCodeMap
) {
  return countryCodeMap[countryCode];
}

export async function getLocationData(headersList: IHeadersList) {
  const city = headersList.get('x-vercel-ip-city') ?? undefined;
  const countryCode = headersList.get('x-vercel-ip-country') ?? undefined;
  const latitude = headersList.get('x-vercel-ip-latitude') ?? undefined;
  const longitude = headersList.get('x-vercel-ip-longitude') ?? undefined;

  // ********* Testing locally: *********
  // const city = headersList.get('x-vercel-ip-city') ?? 'Houston';
  // const countryCode = headersList.get('x-vercel-ip-country') ?? 'US';
  // const latitude = headersList.get('x-vercel-ip-latitude') ?? '29.8131';
  // const longitude = headersList.get('x-vercel-ip-longitude') ?? '-95.3098';

  let country = countryCode
    ? getCountryNameFromCountryCode(countryCode as keyof typeof countryCodeMap)
    : '';

  return { city, country, latitude, longitude };
}

export function getWeatherValues(hourlyData: IHourlyData, index: number) {
  const temperature = Math.round(hourlyData.temperature_2m[index]);
  const humidity = hourlyData.relativehumidity_2m[index];
  const cloudcover = hourlyData.cloudcover[index];
  const winddirection = hourlyData.winddirection_10m[index];
  const windspeed = Math.round(hourlyData.windspeed_10m[index]);
  const visibility = hourlyData.visibility[index] / 1000; // To convert meters to kilometers
  const uv_index = hourlyData.uv_index[index];

  return {
    temperature,
    humidity,
    cloudcover,
    winddirection,
    windspeed,
    visibility,
    uv_index,
  };
}

export function getWeatherDescription(code: keyof typeof weatherCodes) {
  return `${weatherCodes[code].description[0].toUpperCase()}${weatherCodes[
    code
  ].description.slice(1)}`;
}

export function getHourlyExampleData() {
  return {
    time: [
      '2023-09-04T00:00',
      '2023-09-04T01:00',
      '2023-09-04T02:00',
      '2023-09-04T03:00',
      '2023-09-04T04:00',
      '2023-09-04T05:00',
      '2023-09-04T06:00',
      '2023-09-04T07:00',
      '2023-09-04T08:00',
      '2023-09-04T09:00',
      '2023-09-04T10:00',
      '2023-09-04T11:00',
      '2023-09-04T12:00',
      '2023-09-04T13:00',
      '2023-09-04T14:00',
      '2023-09-04T15:00',
      '2023-09-04T16:00',
      '2023-09-04T17:00',
      '2023-09-04T18:00',
      '2023-09-04T19:00',
      '2023-09-04T20:00',
      '2023-09-04T21:00',
      '2023-09-04T22:00',
      '2023-09-04T23:00',
      '2023-09-05T00:00',
      '2023-09-05T01:00',
      '2023-09-05T02:00',
      '2023-09-05T03:00',
      '2023-09-05T04:00',
      '2023-09-05T05:00',
      '2023-09-05T06:00',
      '2023-09-05T07:00',
      '2023-09-05T08:00',
      '2023-09-05T09:00',
      '2023-09-05T10:00',
      '2023-09-05T11:00',
      '2023-09-05T12:00',
      '2023-09-05T13:00',
      '2023-09-05T14:00',
      '2023-09-05T15:00',
      '2023-09-05T16:00',
      '2023-09-05T17:00',
      '2023-09-05T18:00',
      '2023-09-05T19:00',
      '2023-09-05T20:00',
      '2023-09-05T21:00',
      '2023-09-05T22:00',
      '2023-09-05T23:00',
      '2023-09-06T00:00',
      '2023-09-06T01:00',
      '2023-09-06T02:00',
      '2023-09-06T03:00',
      '2023-09-06T04:00',
      '2023-09-06T05:00',
      '2023-09-06T06:00',
      '2023-09-06T07:00',
      '2023-09-06T08:00',
      '2023-09-06T09:00',
      '2023-09-06T10:00',
      '2023-09-06T11:00',
      '2023-09-06T12:00',
      '2023-09-06T13:00',
      '2023-09-06T14:00',
      '2023-09-06T15:00',
      '2023-09-06T16:00',
      '2023-09-06T17:00',
      '2023-09-06T18:00',
      '2023-09-06T19:00',
      '2023-09-06T20:00',
      '2023-09-06T21:00',
      '2023-09-06T22:00',
      '2023-09-06T23:00',
      '2023-09-07T00:00',
      '2023-09-07T01:00',
      '2023-09-07T02:00',
      '2023-09-07T03:00',
      '2023-09-07T04:00',
      '2023-09-07T05:00',
      '2023-09-07T06:00',
      '2023-09-07T07:00',
      '2023-09-07T08:00',
      '2023-09-07T09:00',
      '2023-09-07T10:00',
      '2023-09-07T11:00',
      '2023-09-07T12:00',
      '2023-09-07T13:00',
      '2023-09-07T14:00',
      '2023-09-07T15:00',
      '2023-09-07T16:00',
      '2023-09-07T17:00',
      '2023-09-07T18:00',
      '2023-09-07T19:00',
      '2023-09-07T20:00',
      '2023-09-07T21:00',
      '2023-09-07T22:00',
      '2023-09-07T23:00',
      '2023-09-08T00:00',
      '2023-09-08T01:00',
      '2023-09-08T02:00',
      '2023-09-08T03:00',
      '2023-09-08T04:00',
      '2023-09-08T05:00',
      '2023-09-08T06:00',
      '2023-09-08T07:00',
      '2023-09-08T08:00',
      '2023-09-08T09:00',
      '2023-09-08T10:00',
      '2023-09-08T11:00',
      '2023-09-08T12:00',
      '2023-09-08T13:00',
      '2023-09-08T14:00',
      '2023-09-08T15:00',
      '2023-09-08T16:00',
      '2023-09-08T17:00',
      '2023-09-08T18:00',
      '2023-09-08T19:00',
      '2023-09-08T20:00',
      '2023-09-08T21:00',
      '2023-09-08T22:00',
      '2023-09-08T23:00',
      '2023-09-09T00:00',
      '2023-09-09T01:00',
      '2023-09-09T02:00',
      '2023-09-09T03:00',
      '2023-09-09T04:00',
      '2023-09-09T05:00',
      '2023-09-09T06:00',
      '2023-09-09T07:00',
      '2023-09-09T08:00',
      '2023-09-09T09:00',
      '2023-09-09T10:00',
      '2023-09-09T11:00',
      '2023-09-09T12:00',
      '2023-09-09T13:00',
      '2023-09-09T14:00',
      '2023-09-09T15:00',
      '2023-09-09T16:00',
      '2023-09-09T17:00',
      '2023-09-09T18:00',
      '2023-09-09T19:00',
      '2023-09-09T20:00',
      '2023-09-09T21:00',
      '2023-09-09T22:00',
      '2023-09-09T23:00',
      '2023-09-10T00:00',
      '2023-09-10T01:00',
      '2023-09-10T02:00',
      '2023-09-10T03:00',
      '2023-09-10T04:00',
      '2023-09-10T05:00',
      '2023-09-10T06:00',
      '2023-09-10T07:00',
      '2023-09-10T08:00',
      '2023-09-10T09:00',
      '2023-09-10T10:00',
      '2023-09-10T11:00',
      '2023-09-10T12:00',
      '2023-09-10T13:00',
      '2023-09-10T14:00',
      '2023-09-10T15:00',
      '2023-09-10T16:00',
      '2023-09-10T17:00',
      '2023-09-10T18:00',
      '2023-09-10T19:00',
      '2023-09-10T20:00',
      '2023-09-10T21:00',
      '2023-09-10T22:00',
      '2023-09-10T23:00',
    ],
    temperature_2m: [
      20.2, 19.2, 18.5, 17.9, 17.2, 17, 16.5, 16.7, 19.2, 22.6, 24.3, 25.7,
      26.8, 28, 28.8, 30.2, 29.9, 29.2, 28.3, 26.9, 25.2, 24, 23.3, 22.6, 22.3,
      22, 21.6, 21.1, 20.5, 20.1, 19.8, 19.9, 21.5, 23.3, 25.3, 26.7, 28.1,
      29.2, 28.7, 27.1, 28.1, 28.3, 27.5, 26.4, 24.9, 23.8, 23.2, 22.8, 22.5,
      22.6, 22.3, 21.9, 21.4, 21.1, 21, 21, 22.2, 24.7, 26.6, 27.9, 29.3, 30.8,
      31.4, 30.7, 30.3, 29.4, 28.5, 27.2, 25.7, 24.5, 23.9, 23.1, 22.5, 22.1,
      21.7, 21.3, 21.1, 21, 20.9, 20.8, 22.2, 25.1, 26.7, 28, 29.1, 30, 31.2,
      31.4, 30.9, 29.5, 28.1, 26.5, 24.8, 24.1, 23.4, 23.1, 22.8, 22.5, 22.3,
      22.1, 21.8, 21.5, 21.6, 22.1, 22.9, 23.9, 25.2, 26.7, 28, 29, 29.7, 30,
      29.6, 28.7, 27.5, 26.1, 24.4, 23, 22.1, 21.4, 20.8, 20.2, 19.8, 19.4,
      18.9, 18.6, 18.7, 19.8, 21.3, 22.9, 24.5, 26.1, 27.4, 28.3, 28.9, 29.3,
      28.5, 27.4, 26.1, 24.4, 22.6, 21.1, 20.3, 19.8, 19.2, 18.3, 17.3, 16.6,
      16.1, 15.9, 16.3, 17.8, 20, 22.1, 24, 25.9, 27.3, 28.4, 29.2, 29.3, 28.5,
      27, 25.4, 23.6, 21.7, 20, 19, 18.3,
    ],
    relativehumidity_2m: [
      74, 78, 80, 84, 86, 86, 89, 89, 81, 66, 56, 50, 46, 41, 38, 35, 35, 38,
      40, 48, 51, 56, 61, 64, 65, 66, 68, 71, 74, 76, 78, 79, 76, 68, 57, 53,
      50, 47, 49, 59, 53, 52, 55, 60, 66, 69, 70, 73, 74, 75, 76, 78, 80, 82,
      83, 83, 82, 70, 61, 56, 51, 45, 43, 46, 49, 51, 54, 59, 66, 71, 73, 79,
      83, 84, 86, 88, 89, 89, 89, 89, 88, 71, 63, 56, 52, 49, 43, 41, 42, 46,
      50, 54, 61, 63, 66, 68, 70, 72, 73, 74, 75, 76, 75, 73, 69, 64, 58, 51,
      45, 41, 37, 36, 37, 40, 43, 46, 50, 54, 57, 60, 62, 64, 67, 69, 72, 75,
      75, 71, 65, 59, 53, 48, 43, 40, 37, 36, 38, 40, 42, 47, 53, 57, 58, 58,
      59, 62, 65, 68, 70, 71, 70, 65, 57, 50, 44, 39, 35, 30, 26, 25, 28, 34,
      41, 48, 56, 62, 64, 65,
    ],
    weathercode: [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
      3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 80, 3, 3, 3, 3, 3, 2, 2, 3, 3,
      3, 3, 3, 3, 2, 2, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 1, 2, 2,
      2, 2, 2, 2, 2, 1, 1, 2, 1, 2, 2, 2, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3,
      3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 1, 1, 1, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ],
    cloudcover: [
      0, 0, 4, 2, 1, 11, 2, 2, 2, 3, 21, 28, 27, 32, 34, 72, 71, 100, 100, 100,
      100, 100, 100, 100, 99, 100, 100, 94, 67, 54, 99, 100, 100, 100, 100, 100,
      100, 100, 100, 100, 100, 100, 100, 100, 100, 84, 69, 91, 96, 100, 100, 91,
      90, 63, 47, 91, 100, 93, 71, 79, 71, 97, 97, 100, 100, 100, 92, 43, 30,
      31, 46, 24, 44, 60, 76, 69, 68, 65, 61, 38, 31, 46, 44, 51, 61, 45, 37,
      37, 25, 27, 23, 85, 100, 82, 88, 94, 100, 100, 100, 100, 96, 91, 87, 84,
      81, 78, 71, 64, 57, 54, 52, 49, 56, 64, 71, 74, 78, 81, 54, 28, 1, 1, 0,
      0, 0, 0, 0, 0, 0, 0, 7, 15, 22, 34, 45, 57, 52, 40, 28, 19, 9, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ],
    visibility: [
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 17920, 18180, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 23180, 23520, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
      24140, 24140, 24140, 24140, 24140, 24140, 24140, 24140,
    ],
    windspeed_10m: [
      4.4, 4.1, 3.6, 4.2, 4, 4.5, 4.7, 4.8, 5.1, 9.3, 13.5, 14, 15.1, 14.9,
      13.9, 14, 15.3, 15.4, 18.6, 18.7, 15.5, 12.7, 11.2, 10.8, 9.8, 8.2, 6.9,
      4.5, 5.2, 4.6, 4.3, 4.8, 4.3, 6.1, 10.3, 11.4, 10.9, 11.3, 7.3, 7.9, 10.7,
      11.2, 13.3, 12.4, 10.3, 6.4, 6.2, 5.6, 6.1, 6.4, 5.9, 5.1, 4.6, 4.8, 4.3,
      2.8, 1.8, 5.7, 10.7, 11.6, 11.1, 10.9, 13.9, 15, 15.2, 14.3, 15.6, 13.5,
      10.5, 7.6, 5.2, 3.5, 1.5, 0.4, 1.1, 1.1, 2.2, 2.9, 2.5, 1.8, 1, 6.6, 11,
      12.8, 14.7, 15.9, 16.2, 18.3, 21.9, 23.2, 20.5, 17, 13.4, 10.9, 9.2, 8.1,
      7.4, 6.4, 5.4, 5.1, 5.4, 6.1, 6.9, 7.9, 9.7, 11.2, 12.9, 14.7, 16.1, 17,
      17.8, 18.4, 19.6, 20.6, 20.4, 17.1, 12.2, 8.7, 7.7, 7.7, 7.9, 7.9, 7.7,
      7.7, 7.1, 6.4, 6.6, 9, 12.2, 14.9, 16.6, 17.4, 18.5, 19.3, 20.2, 21.2,
      24.2, 24.5, 23.6, 20, 15.5, 11.8, 10, 9.2, 8.4, 7.6, 6.8, 6.5, 6.2, 6.2,
      6.5, 6.8, 7.6, 9, 11.6, 14.6, 17.5, 20, 21.7, 22.7, 22.7, 21.9, 19.9,
      16.2, 11.6, 8.5, 7.2, 6.8,
    ],
    winddirection_10m: [
      55, 52, 53, 59, 63, 61, 67, 63, 51, 54, 61, 67, 62, 58, 53, 46, 66, 57,
      54, 62, 59, 47, 48, 53, 54, 52, 51, 61, 56, 51, 66, 77, 48, 45, 78, 66,
      81, 81, 57, 47, 48, 50, 41, 26, 29, 38, 36, 40, 50, 52, 47, 51, 45, 48,
      48, 50, 53, 55, 70, 74, 65, 46, 37, 27, 31, 39, 34, 29, 27, 25, 25, 24,
      14, 90, 90, 90, 81, 60, 45, 37, 45, 61, 58, 58, 59, 57, 53, 47, 46, 42,
      38, 36, 31, 34, 39, 45, 51, 52, 48, 45, 48, 50, 51, 51, 48, 50, 54, 59,
      61, 58, 54, 50, 47, 44, 44, 44, 47, 52, 53, 53, 51, 51, 49, 49, 49, 47,
      49, 53, 56, 58, 63, 68, 69, 63, 55, 50, 47, 50, 52, 56, 62, 70, 75, 79,
      83, 87, 90, 93, 97, 100, 96, 90, 82, 74, 64, 57, 53, 51, 50, 48, 48, 48,
      49, 53, 64, 78, 87, 93,
    ],
    is_day: [
      0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
    ] as (0 | 1)[],
    uv_index: [
      0, 0, 0, 0, 0, 0, 0, 0.05, 0.55, 1.65, 3.1, 4.55, 5.7, 6.35, 6.4, 5.8,
      4.7, 3, 1.25, 0.6, 0.05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.45, 1.2, 2.25,
      3.5, 4, 5.1, 5.9, 5.45, 3.7, 2.25, 0.2, 0.15, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.45, 1.35, 2.75, 3.9, 4.9, 5.55, 5.75, 5.55, 4.55, 2.9, 1.65,
      0.6, 0.05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.45, 1.3, 2.95, 3.95, 5.65,
      6.3, 6.3, 5.7, 4.65, 3.2, 1.75, 0.55, 0.05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0.5, 1.6, 3, 4.45, 5.6, 6.25, 6.25, 5.7, 4.6, 3.15, 1.7, 0.55, 0.05, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5, 1.55, 2.45, 3.45, 4.35, 5.15, 5.85, 6,
      5.35, 4.2, 3.05, 2, 0.95, 0.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0.25, 0.7,
      1.75, 3.1, 4.2, 5, 5.5, 5.6, 5, 3.9, 2.85, 1.85, 0.85, 0.15, 0, 0,
    ],
  };
}
